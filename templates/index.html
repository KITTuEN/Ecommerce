{% extends "base.html" %}

{% block title %}Home - BRAEV{% endblock %}

{% block content %}
<!-- Hero Section -->
<section class="hero-section">
    <img src="{{ url_for('static', filename='images/11.png') }}" alt="Hero Background" class="hero-bg" id="hero-image">
    <div class="hero-overlay"></div>
    <div class="hero-content">
        <h1 class="hero-title">Elevate Your Everyday</h1>
        <p class="hero-subtitle">Discover our new collection of premium essentials designed for modern living.</p>
        <a href="#shop-section" class="hero-btn">Shop Now</a>
    </div>
</section>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const heroImages = [
            "{{ url_for('static', filename='images/11.png') }}",
            "{{ url_for('static', filename='images/22.png') }}",
            "{{ url_for('static', filename='images/33.png') }}"
        ];

        const heroImg = document.getElementById('hero-image');

        if (heroImg) {
            // Set initial random image
            let currentIndex = Math.floor(Math.random() * heroImages.length);
            heroImg.src = heroImages[currentIndex];

            // Change image every 3 seconds
            setInterval(() => {
                // Pick a new random index different from current
                let newIndex;
                do {
                    newIndex = Math.floor(Math.random() * heroImages.length);
                } while (newIndex === currentIndex && heroImages.length > 1);

                currentIndex = newIndex;
                heroImg.src = heroImages[currentIndex];
            }, 3000);
        }
    });
</script>

<div class="container py-5">
    <!-- Categories -->
    {% if not selected_category %}
    <div class="section-header">
        <h2 class="section-title">Shop by Category</h2>
    </div>
    <div class="row g-4 mb-5">
        {% for category in categories %}
        <div class="col-md-4 col-6">
            <a href="{{ url_for('index', category=category.name) }}" class="text-decoration-none d-block">
                <div class="category-card mb-3">
                    <img src="{{ category.image_url }}" alt="{{ category.name }}">
                </div>
                <h3 class="h5 text-center text-dark">{{ category.name|title }}</h3>
            </a>
        </div>
        {% endfor %}
    </div>
    {% endif %}

    <div id="shop-section">
        {% if selected_category %}
        <!-- Filter Toolbar -->
        <div class="d-flex justify-content-between align-items-center mb-4">
            <div class="d-flex align-items-center gap-3">
                <a href="{{ url_for('index') }}" class="btn btn-outline btn-sm">
                    <i class="fas fa-arrow-left me-2"></i> Back
                </a>
                <h2 class="h4 mb-0">{{ selected_category|title }}</h2>
            </div>

            <div class="d-flex gap-2 align-items-center">
                <span class="text-muted small">Filter by:</span>
                {% for brand in brands[:3] %}
                <a href="{{ url_for('index', category=selected_category, brand=brand) }}"
                    class="btn btn-sm {{ 'btn-dark' if selected_brand == brand else 'btn-outline' }}">{{
                    brand|title
                    }}</a>
                {% endfor %}
            </div>
        </div>
        {% else %}
        <div class="section-header mt-5">
            <h2 class="section-title">Featured Products</h2>
            <a href="#" class="text-decoration-underline">View All</a>
        </div>
        {% endif %}

        <!-- Product Grid -->
        <div class="row g-4">
            {% for product in products %}
            <div class="col-lg-3 col-md-4 col-6">
                <div class="product-card">
                    <div class="product-img-wrapper">
                        <a href="{{ url_for('product_detail', product_id=product['_id']) }}">
                            <img src="{{ product.image_url }}" alt="{{ product.name }}">
                        </a>
                        <div class="product-actions">
                            <form action="{{ url_for('add_to_cart', product_id=product['_id']) }}" method="POST"
                                class="d-inline">
                                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                                <input type="hidden" name="size"
                                    value="{{ (product.sizes[0].size if product.sizes[0] is mapping else product.sizes[0]) if product.sizes else '' }}">
                                <input type="hidden" name="color"
                                    value="{{ product.colors[0] if product.colors else product.color if product.color else '' }}">
                                <button type="submit" class="action-btn" title="Add to Cart"><i
                                        class="fas fa-shopping-bag"></i></button>
                            </form>
                            <form action="{{ url_for('add_to_wishlist', product_id=product['_id']) }}" method="POST"
                                class="d-inline">
                                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                                <button type="submit" class="action-btn" title="Wishlist"><i
                                        class="fas fa-heart"></i></button>
                            </form>
                            <a href="{{ url_for('product_detail', product_id=product['_id']) }}" class="action-btn"
                                title="View"><i class="fas fa-eye"></i></a>
                        </div>
                    </div>
                    <div class="product-details text-start p-0">
                        <h3 class="product-title">
                            <a href="{{ url_for('product_detail', product_id=product['_id']) }}">{{ product.name }}</a>
                        </h3>
                        <div class="d-flex justify-content-between align-items-center">
                            <span class="product-price">â‚¹{{ product.price }}</span>
                            <div class="text-warning small">
                                <i class="fas fa-star"></i> {{ product.average_rating if product.average_rating > 0 else
                                0 }}
                                <span class="text-muted">({{ product.review_count }})</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>

        <!-- Pagination -->
        {% if total_pages > 1 %}
        <div class="d-flex justify-content-center mt-5">
            <nav aria-label="Page navigation">
                <ul class="pagination">
                    {% if current_page > 1 %}
                    <li class="page-item">
                        <a class="page-link"
                            href="{{ url_for('index', page=current_page-1, q=search_query, category=selected_category) }}"
                            aria-label="Previous">
                            <span aria-hidden="true">&laquo;</span>
                        </a>
                    </li>
                    {% endif %}

                    {% for p in range(1, total_pages + 1) %}
                    <li class="page-item {{ 'active' if p == current_page else '' }}">
                        <a class="page-link"
                            href="{{ url_for('index', page=p, q=search_query, category=selected_category) }}">{{ p
                            }}</a>
                    </li>
                    {% endfor %}

                    {% if current_page < total_pages %} <li class="page-item">
                        <a class="page-link"
                            href="{{ url_for('index', page=current_page+1, q=search_query, category=selected_category) }}"
                            aria-label="Next">
                            <span aria-hidden="true">&raquo;</span>
                        </a>
                        </li>
                        {% endif %}
                </ul>
            </nav>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}